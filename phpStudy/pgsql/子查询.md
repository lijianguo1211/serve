### 子查询

```php
t1.imsi,
	t1.dev_id,
	t1.capture_time,
	t2.dev_address
<?php

$subQuery = DB::table('device_imsi as d')
->select('d.imsi','d.dev_id',DB::raw("max(d.capture_time) as capture_time"))
->whereBetween('d.capture_time',[$start,$end])
->whereIn('d.dev_id',[])
->groupBy(DB::raw("d.dev_id, d.imsi"));
DB::table(DB::raw("({$subQuery->toSql()}) as t1"))
->select('t1.imsi','t1.dev_id','t1.capture_time','t2.dev_address')
->join('base_device t2','t1.dev_id','=','t2.dev_id');
?>

```

```mysql
SELECT
			d.imsi,
			d.dev_id,
			MAX (d.capture_time) AS capture_time
		FROM
			device_imsi d
		WHERE
			d.capture_time >= 1524888756
		AND d.capture_time < 1524931199
		--AND d.dev_id IN ('w1-c049','w1-c046')
		GROUP BY
			d.dev_id,
			d.imsi
```

```mysql
at Connection
->runQueryCallback('select "t1"."imsi", "t1"."dev_id", "t1"."capture_time", "t2"."dev_address" from (select "d"."imsi", "d"."dev_id", max(d.capture_time) as capture_time from "device_imsi" as "d" where "d"."capture_time" between ? and ? group by d.dev_id, d.imsi) as t1 inner join "base_device" as "t2" on "t1"."dev_id" = "t2"."dev_id" limit 5 offset 10',
 array(),
  object(Closure))
   in Connection.php line 622
```

```mysql
at Connection->run(
'select "t1"."imsi", "t1"."dev_id", "t1"."capture_time", "t2"."dev_address" from (select "d"."imsi", "d"."dev_id", max(d.capture_time) as capture_time from "device_imsi" as "d" where "d"."capture_time" between ? and ? group by d.dev_id, d.imsi) as t1 inner join "base_device" as "t2" on "t1"."dev_id" = "t2"."dev_id" limit 5 offset 10',
 array(),
  object(Closure)
  ) in Connection.php line 324
```